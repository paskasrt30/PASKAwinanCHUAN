$(document).ready(function(){$(".elementor-field-group-countpeople").hide();$("#form-field-countpeople").attr("disabled",!0);$("option[value=0]").attr("disabled",!0);var commentContainer=$("#rsvp-data-container");var invitationID=rsvpSettings.invitation_id;var webhookID=rsvpSettings.webhook_id;var language=rsvpSettings.language;var showGuestCountOnRsvpOptions=rsvpSettings.show_guest_count_on_rsvp_options.split("|");var maxGuest=$("#guest-data").data("max-guest")||rsvpSettings.default_max_guest;var guestName=$("#guest-data").data("name");var errMsg=language==='en'?'Please select your attendance':'Kehadiran harus diisi';$('<div class="noticeConfirm">'+errMsg+'</div>').insertAfter(".elementor-form-fields-wrapper");var checkMark='<svg width="14px" height="11px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="checkmark" preserveAspectRatio="xMidYMid meet" fill="#FFFFFF"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path fill="#ffffff" d="M34.459 1.375a2.999 2.999 0 0 0-4.149.884L13.5 28.17l-8.198-7.58a2.999 2.999 0 1 0-4.073 4.405l10.764 9.952s.309.266.452.359a2.999 2.999 0 0 0 4.15-.884L35.343 5.524a2.999 2.999 0 0 0-.884-4.149z"></path></g></svg>'
var successMsg=language==='en'?'&nbsp;Thank you, we have received your response!':'&nbsp;Terima kasih, respon anda sudah diterima!';$('<div class="noticeSuccess">'+checkMark+successMsg+'</div>').insertAfter('form[name="nama mempelai"]');constructForm();fetchAndDisplayComments();$("#form-field-confirmattend").on("change",function(){if(showGuestCountOnRsvpOptions.includes($(this).val())){$(".elementor-field-group-countpeople").show();$("#form-field-countpeople").prop("disabled",!1)}else{$(".elementor-field-group-countpeople").hide()}
if($(".noticeConfirm").css("display")!=="none"){$(".noticeConfirm").toggle()}});var elForm_btn=$(".elementor-field-type-submit button");if(elForm_btn.length>0&&!elForm_btn.attr("listenerOnClick")){elForm_btn.on("click",function(){submitForm()})}
elForm_btn.attr("listenerOnClick","true");function submitForm(){const elFrom_Name=$("#form-field-guestname").val();const elFrom_Text=$("#form-field-messagestext").val();const elFrom_Attend=$("select[id=form-field-confirmattend]").val();const elFrom_Count=$("select[id=form-field-countpeople]").val();if(elFrom_Name===""){return}
if(elFrom_Attend==null){$(".noticeConfirm").toggle();return}
var body={name:elFrom_Name,text:elFrom_Text,status:elFrom_Attend,};if(elFrom_Count!==null&&showGuestCountOnRsvpOptions.includes(elFrom_Attend)){body.guest_count=parseInt(elFrom_Count)}
fetch(`https://api.envelope.id/v1/webhook/rsvp/${webhookID}`,{method:"POST",headers:{"Content-Type":"application/json",},body:JSON.stringify(body),}).then((response)=>response.json()).then((data)=>{console.log("Server response:",data);$('form[name="nama mempelai"]').hide();$(".noticeSuccess").show();fetchAndDisplayComments()}).catch((error)=>console.error("Error submitting form:",error));return}
function fetchAndDisplayComments(){if(commentContainer.length===0){return}
var hasExistingComments=commentContainer.find('.comment').length>0;fetch(`https://api.envelope.id/v1/invitation/${invitationID}/rsvp/data`).then(response=>response.json()).then(data=>{if(data.data.length>0){commentContainer.show();commentContainer.empty();$.each(data.data,function(_index,comment){if(!comment.text||comment.text.trim()===''){return}
var commentDiv=$("<div>").addClass("comment");var nameSpan=$("<span>").addClass("name").text(comment.name);var textSpan=$("<span>").addClass("text").text(comment.text);var timeSpan=$("<span>").addClass("time").text(formatTimeAgo(comment.created_at));commentDiv.append(nameSpan,textSpan,timeSpan);commentContainer.append(commentDiv)})}else{commentContainer.hide()}}).catch(error=>{if(!hasExistingComments){commentContainer.hide()}
console.error("Error fetching comments:",error)})}
function formatTimeAgo(datetimeString){var now=new Date();var targetDate=new Date(datetimeString);var timeDifference=now-targetDate;var seconds=Math.floor(timeDifference/1000);var minutes=Math.floor(seconds/60);var hours=Math.floor(minutes/60);var days=Math.floor(hours/24);var secondsAgo=language==='en'?'seconds ago':'detik lalu';var hoursAgo=language==='en'?'hours ago':'jam lalu';var minutesText=language==='en'?'minutes':'menit';var daysText=language==='en'?'days':'hari';if(seconds<60){return `${seconds} ${secondsAgo}`}else if(minutes<60){var remainingSeconds=seconds%60;return `${minutes} ${minutesText} ${remainingSeconds} ${secondsAgo}`}else{var remainingHours=hours%24;return `${days} ${daysText} ${remainingHours} ${hoursAgo}`}}
function constructForm(){const urlParams=new URLSearchParams(window.location.search);const code=urlParams.get('code');if(!code){return}
if(guestName&&guestName.trim()!==''){var guestNameInput=$("#form-field-guestname");guestNameInput.val(guestName);guestNameInput.attr("disabled",!0)}
var guestSelect=$("#form-field-countpeople");guestSelect.empty();for(let i=1;i<=maxGuest;i++){if(i===1){personText=language==='en'?'Guest':'Orang'}else{personText=language==='en'?'Guests':'Orang'}
const option=$('<option>',{value:i,text:`${i} ${personText}`});if(i===1){option.attr('selected','selected')}
guestSelect.append(option)}}})
;